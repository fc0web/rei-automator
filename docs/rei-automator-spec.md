# Rei Automator 仕様書

**プロジェクト名:** Rei Automator（Rei PC自動操作ツール）
**バージョン:** v0.1（初期設計）
**作成日:** 2026年2月17日
**著者:** 藤本 伸樹（Nobuki Fujimoto）

---

## 1. プロダクト概要

### 1.1 定義

Rei Automatorは、Rei言語をベースとした軽量PC自動操作ツールである。
日本語の自然言語入力から短いReiコードを生成し、ユーザーが確認した上で実行する
「三層構造」を採用する。

### 1.2 ポジショニング

| 項目 | UWSC | 大手AI（Copilot等） | Rei Automator |
|------|------|---------------------|---------------|
| 対象 | コード書ける個人 | 企業（米国中心） | 誰でも（日本語対応） |
| 価格 | 無料 | 月額$30〜+従量課金 | 買い切り¥5,000 or 月額¥500〜980 |
| 方式 | スクリプト実行 | AIが毎回判断 | 日本語→Reiコード→スクリプト実行 |
| 責任 | ユーザー自己責任 | 企業が責任を負う | ユーザー自己責任（道具として提供） |
| 動作 | オフライン | クラウド必須 | 基本オフライン（AI変換時のみAPI） |
| 日本語 | ◯ | △（未提供/限定的） | ◎（ネイティブ） |
| デスクトップ操作 | ◯ | △（ブラウザ中心） | ◯ |

### 1.3 大手が構造的に参入できない理由

1. **責任問題**: AIが操作→事故時に企業が訴訟リスクを負う
2. **セキュリティ**: AIエージェント乗っ取りの攻撃対象になる
3. **収益矛盾**: 完全自動化はUI・広告の価値を毀損する
4. **規制の壁**: AI自動操作の法的枠組みが未整備
5. **信頼性不足**: Operator成功率38〜58%で製品レベル未到達
6. **コスト構造**: AIが毎回画面を見る→GPU消費→安価提供不可

Reiは「ユーザーがコードを確認して実行する道具」であり、上記を構造的に回避する。

---

## 2. 三層アーキテクチャ

```
第1層: 自然言語入力（日本語/英語）
  ↓
第2層: Reiコード生成（変換層）
  ├── ローカルパターンマッチ（基本操作：API不要・無料）
  └── 外部AI API（複雑な指示：Claude/GPT経由）
  ↓
  【ユーザー確認】← 大手との決定的な違い（コードが2〜5行で確認が一瞬）
  ↓
第3層: 実行エンジン（PC操作）
  ├── マウス操作（クリック・移動・ドラッグ）
  ├── キーボード操作（文字入力・キー送信）
  ├── 画面認識（色検出・画像マッチング・OCR）
  └── ウィンドウ操作（取得・移動・サイズ変更）
```

### 大手との構造的違い

```
大手のアプローチ:
  AIが画面を見る → AIが判断 → AIが操作 → 毎回リスク → 毎回GPU消費
  → 企業が責任 → 制限だらけ

Reiのアプローチ:
  日本語入力 → Reiコード生成 → ユーザーが確認 → スクリプト実行
  → 一度確認したら何度でも再実行 → コストゼロ → 制限なし
```

---

## 3. UWSCとの根本的な違い

### 従来（UWSC）: 12ステップ

1. MT4画面でサイン出現場所を目視確認
2. PrintScreenでスクリーンショット撮影
3. ペイントに貼り付け
4. サイン部分を切り取り
5. スポイトツールでRGB値を確認
6. 画像をフォルダに保存（パス管理）
7. MT4上のサインの座標をマウスで確認
8. クリックしたい箇所の座標も確認
9. コードを手書き（UWSC構文暗記が必要）
10. UWSCを起動してスクリプト読み込み
11. 実行ボタン
12. ESCキーで強制終了

### Rei Automator: 3ステップ

1. 📷 キャプチャモードで認識対象をドラッグ選択 → 色・画像自動保存
2. 🎯 クリック先指定モードでクリック場所を指定 → 座標自動記録
3. 日本語で動作を入力 → コード生成 → 確認 → 実行

---

## 4. 機能仕様

### 4.1 コア機能（5カテゴリ）

#### A. 画面認識

| 機能 | 説明 | UWSCの対応関数 |
|------|------|----------------|
| 色検出 | 指定座標のRGB値を取得・比較 | PEEKCOLOR |
| 画像マッチング | 画面上から指定画像の位置を検索 | CHKIMG |
| OCR（文字認識） | 画面上の文字・数字を読み取り | （外部ツール必要だった） |
| AI視覚認識 | AIに画面を見せて要素を特定（オプション） | （存在しなかった） |

#### B. マウス操作

| 機能 | 説明 |
|------|------|
| クリック | 指定座標を左クリック |
| ダブルクリック | 指定座標をダブルクリック |
| 右クリック | 指定座標を右クリック |
| ドラッグ | 始点から終点までドラッグ |
| 移動 | マウスカーソルを指定座標に移動 |

#### C. キーボード操作

| 機能 | 説明 |
|------|------|
| 文字入力 | 指定文字列をタイプ |
| キー送信 | Enter、Tab、Escなどの特殊キー |
| ショートカット | Ctrl+C、Ctrl+Vなどの組み合わせ |

#### D. ウィンドウ操作

| 機能 | 説明 |
|------|------|
| ウィンドウ取得 | タイトル名でウィンドウを特定 |
| アクティブ化 | 指定ウィンドウを前面に表示 |
| サイズ変更 | ウィンドウの位置・サイズを設定 |

#### E. フロー制御

| 機能 | 説明 |
|------|------|
| 待機 | 指定秒数待つ |
| 条件待機 | 指定条件（色・画像の出現）まで待つ |
| 繰り返し | 指定回数または無限ループ |
| 条件分岐 | 画面の状態に応じて動作を変える |

### 4.2 Reiコード構文

```rei
// === 基本操作 ===

// 色を認識してクリック
screen(100, 200).color == "#FF0000" -> click

// 画像を見つけてダブルクリック
screen.find(captured_1) -> dblclick

// 文字を読んで条件判定
screen(300, 400).text == "完了" -> click(500, 600)

// 座標をクリックして数字を入力
click(200, 300) -> type("12345")

// === 待機 ===

// 3秒待ってからクリック
wait(3s) -> click(target_1)

// 条件が出るまで待機してから操作
watch(captured_1) -> wait(3s) -> click(target_1) -> wait(2s) -> click(target_2)

// === ループ ===

// 無限ループ
loop:
  watch(captured_1)
    -> wait(3s) -> click(target_1)
    -> wait(2s) -> click(target_2)

// 回数指定ループ
loop(10):
  click(target_1) -> wait(1s)

// === 条件分岐 ===
screen(100, 200).color == "#FF0000" -> click(target_1)
screen(100, 200).color == "#0000FF" -> click(target_2)

// === ウィンドウ操作 ===
window("MetaTrader") -> activate -> resize(800, 600)
```

### 4.3 日本語→Reiコード変換

#### ローカル変換パターン（AI API不要・完全オフライン）

| 日本語入力 | 生成されるReiコード |
|------------|---------------------|
| 「〇〇をクリック」 | `click(target_〇〇)` |
| 「〇〇をダブルクリック」 | `dblclick(target_〇〇)` |
| 「〇〇と入力」 | `type("〇〇")` |
| 「〇〇秒待つ」 | `wait(〇〇s)` |
| 「ずっと繰り返す」 | `loop:` |
| 「〇〇回繰り返す」 | `loop(〇〇):` |
| 「〇〇が出たら」 | `watch(captured_〇〇) ->` |
| 「〇〇を保存」 | `shortcut(ctrl+s)` |

基本パターンは正規表現で処理。API呼び出し不要（完全オフライン・無料）。

#### AI API変換（複雑な指示のみ）

例：「画面に赤いサインが出たら3秒後にクリックして、その後2秒後に下のボタンもクリック、これをずっと繰り返す」

→ Claude/GPT APIを呼び出してReiコードを生成。月に数十回程度の利用を想定。

---

## 5. UI仕様

### 5.1 メインウィンドウ

```
┌──────────────────────────────────────────────────┐
│  Rei Automator v0.1                        [_][×]│
├──────────────────────────────────────────────────┤
│ [📷キャプチャ] [🎯座標指定] [📂開く] [💾保存]      │
├──────────────────────────────────────────────────┤
│ 日本語入力:                                       │
│ ┌──────────────────────────────────────────────┐ │
│ │（ここに日本語で操作内容を入力）               │ │
│ └──────────────────────────────────────────────┘ │
│                              [🔄 コード生成]      │
├──────────────────────────────────────────────────┤
│ Reiコード:                                        │
│ ┌──────────────────────────────────────────────┐ │
│ │ loop:                                        │ │
│ │   watch(captured_1)                          │ │
│ │     -> wait(3s) -> click(target_1)           │ │
│ │     -> wait(2s) -> click(target_2)           │ │
│ └──────────────────────────────────────────────┘ │
├──────────────────────────────────────────────────┤
│ キャプチャ済み素材:                                │
│ [captured_1: 🖼赤サイン] [target_1: 🎯(450,320)]  │
│ [target_2: 🎯(800,500)]                          │
├──────────────────────────────────────────────────┤
│   [▶ 実行]  [⏹ 停止]  [⏸ 一時停止]               │
│   ステータス: 待機中                               │
└──────────────────────────────────────────────────┘
```

### 5.2 キャプチャモード

📷ボタンを押すと:
1. 画面全体が半透明オーバーレイで覆われる
2. マウスでドラッグして範囲を選択
3. 選択範囲の画像が自動保存（captured_1, captured_2...）
4. RGB値も自動抽出
5. ペイント・フォルダ管理は一切不要

### 5.3 座標指定モード

🎯ボタンを押すと:
1. マウスカーソルが十字線に変わる
2. クリックしたい場所をクリック
3. 座標が自動記録（target_1, target_2...）
4. 手動でx,y座標を調べる必要なし

### 5.4 操作フロー

```
[初回利用時]
1. Rei Automatorを起動
2. 📷キャプチャで認識したい画像/色を選択
3. 🎯座標指定でクリック先を指定
4. 日本語で動作を入力（または直接Reiコードを書く）
5. [コード生成]で変換
6. 生成されたReiコードを確認（2〜5行）
7. [▶ 実行]

[2回目以降]
1. Rei Automatorを起動
2. 保存済みスクリプトを開く
3. [▶ 実行]
```

---

## 6. 技術仕様

### 6.1 システム構成

```
rei-automator/
├── bin/
│   └── rei-automator.exe       （起動用バイナリ）
├── lib/
│   ├── core/
│   │   ├── parser.ts           （Reiコードパーサー：既存流用）
│   │   └── runtime.ts          （実行エンジン：既存流用）
│   ├── auto/
│   │   ├── screen.ts           （画面キャプチャ・色取得）
│   │   ├── image-match.ts      （画像マッチング）
│   │   ├── ocr.ts              （文字認識）
│   │   ├── mouse.ts            （マウス操作）
│   │   ├── keyboard.ts         （キーボード操作）
│   │   └── window.ts           （ウィンドウ操作）
│   ├── nlp/
│   │   ├── local-patterns.ts   （ローカル日本語パターン変換）
│   │   └── ai-convert.ts       （AI API連携）
│   └── ui/
│       ├── main-window.ts      （メインUI）
│       ├── capture-mode.ts     （キャプチャモード）
│       └── target-mode.ts      （座標指定モード）
├── captures/                    （キャプチャ画像自動保存）
├── scripts/                     （ユーザーのReiスクリプト）
└── package.json
```

### 6.2 技術スタック

| レイヤー | 技術 | 理由 |
|----------|------|------|
| UI | Electron（軽量設定） | ReiのTS基盤と相性良好 |
| Reiランタイム | 既存Reiエンジン | 流用でコスト削減 |
| マウス/KB | robotjs or nutjs | Node.js用OS操作ライブラリ |
| 画面キャプチャ | screenshot-desktop | 軽量スクリーンショット |
| 画像マッチング | opencv4nodejs | テンプレートマッチング |
| OCR | tesseract.js | オフラインOCR |
| Win32 API | node-ffi-napi | ウィンドウ操作用 |
| AI連携 | fetch API | Claude/GPT APIへのHTTP通信 |

### 6.3 コード量見積もり

| モジュール | 推定行数 | 備考 |
|------------|----------|------|
| Reiコアエンジン（既存流用） | 0行 | 既存rei-langから流用 |
| OS操作層（auto/） | 約2,000行 | 6モジュール×約350行 |
| 日本語変換（nlp/） | 約500行 | ローカルパターン+AI連携 |
| UI層（ui/） | 約1,500行 | メイン画面+2モード |
| 設定・ユーティリティ | 約500行 | ファイル管理、設定等 |
| **合計追加分** | **約4,500行** | |

### 6.4 動作環境

| 項目 | 要件 |
|------|------|
| OS | Windows 10/11（64bit） |
| メモリ | 4GB以上 |
| ディスク | 約200MB（Electron含む） |
| ネットワーク | 基本不要（AI変換使用時のみ） |
| 権限 | 管理者権限不要 |

---

## 7. UWSCからの移行パス

### 7.1 構文対応表

| UWSC | Rei | 説明 |
|------|-----|------|
| `BTN(LEFT, CLICK, x, y)` | `click(x, y)` | 左クリック |
| `BTN(LEFT, DBLCLK, x, y)` | `dblclick(x, y)` | ダブルクリック |
| `KBD(VK_RETURN)` | `key(enter)` | Enterキー |
| `CHKIMG("path.bmp")` | `screen.find(captured_1)` | 画像認識 |
| `PEEKCOLOR(x, y)` | `screen(x, y).color` | 色取得 |
| `SENDSTR(id, "text")` | `type("text")` | 文字入力 |
| `SLEEP(sec)` | `wait(秒s)` | 待機 |
| `WHILE TRUE〜WEND` | `loop:` | 無限ループ |
| `FOR i=0 TO n〜NEXT` | `loop(n):` | 回数ループ |
| `IFB〜ENDIF` | `条件 -> 操作` | 条件分岐 |
| `GETID("title")` | `window("title")` | ウィンドウ取得 |
| `ACW(id,x,y,w,h)` | `window("t") -> resize(w,h)` | ウィンドウサイズ |

### 7.2 コード比較

**UWSC（10行）:**
```uwsc
WHILE TRUE
  IFB CHKIMG("C:\uwsc\img\sign.bmp", 0, 400, 200, 600, 500)
    SLEEP(3)
    BTN(LEFT, CLICK, 800, 500)
    SLEEP(2)
    BTN(LEFT, CLICK, 850, 550)
    SLEEP(2)
    BTN(LEFT, CLICK, 900, 600)
  ENDIF
  SLEEP(1)
WEND
```

**Rei（4行）:**
```rei
loop:
  watch(captured_1)
    -> wait(3s) -> click(target_1)
    -> wait(2s) -> click(target_2)
```

**日本語入力（1行）:**
```
「サインが出たら3秒後にクリック、2秒後にもう一つクリック、繰り返す」
```

---

## 8. ビジネスモデル

### 8.1 価格設計

| プラン | 価格 | 内容 |
|--------|------|------|
| 無料版 | ¥0 | Reiコード手書きのみ。AI変換なし。スクリプト3個まで |
| ベーシック | ¥980/月 or ¥5,800買い切り | AI日本語変換（月100回）。キャプチャモード。無制限スクリプト |
| プロ | ¥1,980/月 | AI変換無制限。OCR。高精度画像マッチング。優先サポート |

### 8.2 コスト構造

| 項目 | コスト | 備考 |
|------|--------|------|
| AI API | 約¥1-5/回 | 月100回で¥100-500 |
| サーバー | ¥0 | ローカル動作 |
| 配布 | ¥0 | 自社サイトからDL |
| **損益分岐** | **約50ユーザー** | ベーシック×50≒¥49,000/月 |

### 8.3 マーケティング方針

**表に出すユースケース:**
- 複数システム間のデータ転記
- 定型的なファイル操作の自動化
- 繰り返しの入力作業
- 日次レポートの自動生成フロー

**表に出さないが実際の需要源:**
- FX/トレーディングのサイン監視・自動クリック
- ゲーム内の繰り返し操作
- その他、ユーザーが自己責任で使う用途全般

---

## 9. 開発ロードマップ

### Phase 1: MVP — 1〜2ヶ月

- マウス操作（クリック・ダブルクリック）
- キーボード操作（文字入力・キー送信）
- 色検出（ピクセルRGB取得・比較）
- 待機・ループ
- Reiコード直接記述・実行
- 停止ボタン（ESCキー対応）
- 基本UI

### Phase 2: ユーザビリティ強化 — 2〜3ヶ月

- キャプチャモード（範囲選択→自動保存）
- 座標指定モード（クリックで記録）
- 画像マッチング
- 日本語→Reiコード変換（ローカルパターン）
- スクリプトの保存・読み込み

### Phase 3: AI連携・高度機能 — 3〜4ヶ月

- AI API連携（複雑な日本語→Reiコード変換）
- OCR（画面の文字認識）
- ウィンドウ操作
- 条件分岐の強化
- エラーハンドリング

### Phase 4: 多言語・拡張 — 将来

- 英語対応（AI APIが自動対応するため技術的には容易）
- 他言語展開
- プラグインシステム
- コミュニティ・マーケットプレイス

---

## 10. 競合差別化サマリー

### vs 大手AIエージェント

| 観点 | 大手AI | Rei Automator |
|------|--------|---------------|
| 思想 | AIが考えて操作 | ユーザーが定義し道具として使う |
| 毎回の動作 | AIが画面を見て判断（毎回GPU） | スクリプト繰り返し（コストゼロ） |
| 信頼性 | 38〜58%成功率 | 100%（定義通りに動作） |
| コスト | 月額$30〜+従量課金 | ¥980/月 or ¥5,800買い切り |
| オフライン | 不可 | 可（基本機能全てオフライン） |
| 対象アプリ | ブラウザ中心 | デスクトップアプリ含む全て |
| 日本対応 | 米国優先 | 日本語ネイティブ |
| 責任構造 | 企業が責任→制限多数 | ユーザー自己責任→制限なし |
| 透明性 | ブラックボックス | コードが2〜5行で読める |

### vs UWSC

| 観点 | UWSC | Rei Automator |
|------|------|---------------|
| 準備ステップ | 12ステップ | 3ステップ |
| 必要知識 | プログラミング基礎 | なし（日本語入力可） |
| 画像管理 | 手動（ペイント→保存→パス入力） | 自動（キャプチャモードで完結） |
| 座標取得 | 別ツール＋手入力 | 画面クリックで自動記録 |
| コード量 | 10行以上 | 2〜5行 |
| 開発状況 | 開発者逝去→消滅 | オープンソース（継続性担保） |

---

## 11. 法的事項

### 11.1 利用規約の要点

- Rei Automatorは汎用PC操作自動化ツールである
- 使用によって生じた損害について開発者は責任を負わない
- 使用方法はユーザーが決定する（道具としての提供）

### 11.2 ライセンス

- Reiコアエンジン: 既存のRei言語ライセンスに準拠
- Rei Automator: デュアルライセンス（無料版: MIT / 有料版: 商用ライセンス）

---

## 付録: Reiの哲学との接続

Rei Automatorは、Reiの「中心-周囲パターン」を体現している。

- **中心**: ユーザーの意図（日本語で表現される操作の目的）
- **周囲**: PC上の各アプリケーション、OS API、画面上の視覚情報

ユーザーの意図を中心に据え、周囲のシステムリソースを橋渡しする設計思想は、
D-FUMTの理論的基盤と一致する。Rei Automatorは、Reiの計算理論を
最も直感的に体験できるプロダクトとなることを目指す。
