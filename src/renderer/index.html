<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rei Automator</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div id="app">

    <!-- ========== ヘッダー ========== -->
    <header id="app-header">
      <div class="header-left">
        <span class="app-logo">⚡</span>
        <span class="app-title">Rei Automator</span>
        <span class="phase-badge">Phase 6</span>
      </div>
      <div class="header-center">
        <span id="current-script-name" class="current-script">無題のスクリプト</span>
        <span id="dirty-indicator" class="dirty-dot" hidden>●</span>
      </div>
      <div class="header-right">
        <button id="btn-new" class="header-btn" title="新規作成">📄 新規</button>
        <button id="btn-save" class="header-btn" title="保存 (Ctrl+S)">💾 保存</button>
        <button id="btn-settings" class="header-btn icon-only" title="設定">⚙️</button>
      </div>
    </header>

    <!-- ========== メインレイアウト ========== -->
    <div id="main-layout">

      <!-- ===== サイドパネル（A: スクリプト管理） ===== -->
      <aside id="sidebar">
        <div class="sidebar-header">
          <span class="sidebar-title">📂 スクリプト</span>
          <button id="btn-sidebar-toggle" class="icon-btn" title="サイドバーを閉じる">◀</button>
        </div>

        <div class="sidebar-search">
          <input id="script-search" type="text" placeholder="🔍 検索..." />
        </div>

        <div id="script-list" class="script-list">
          <!-- JavaScriptで動的に生成 -->
          <div class="empty-state">スクリプトがありません</div>
        </div>

        <div class="sidebar-footer">
          <button id="btn-import" class="sidebar-btn">📥 インポート</button>
          <button id="btn-export" class="sidebar-btn">📤 エクスポート</button>
        </div>
      </aside>

      <!-- ===== メインエリア ===== -->
      <main id="main-area">

        <!-- エディタセクション -->
        <section id="editor-section">
          <div class="section-toolbar">
            <div class="toolbar-left">
              <label class="toolbar-label">📝 Reiスクリプト</label>
            </div>
            <div class="toolbar-right">
              <!-- D: 変数パネルトグル -->
              <button id="btn-vars-toggle" class="toolbar-btn" title="変数パネル">🔤 変数</button>
              <!-- 日本語入力 -->
              <button id="btn-nlp-toggle" class="toolbar-btn" title="日本語変換">🇯🇵 変換</button>
            </div>
          </div>

          <!-- D: パラメータ入力ダイアログエリア（実行前に表示） -->
          <div id="params-panel" class="params-panel" hidden>
            <div class="params-header">
              <span>⚙️ パラメータ設定</span>
              <button id="btn-params-close" class="icon-btn">✕</button>
            </div>
            <div id="params-inputs" class="params-inputs">
              <!-- 動的生成 -->
            </div>
            <div class="params-actions">
              <button id="btn-params-run" class="run-btn">▶ この設定で実行</button>
              <button id="btn-params-cancel" class="cancel-btn">キャンセル</button>
            </div>
          </div>

          <!-- スクリプトエディタ -->
          <textarea id="script-editor" spellcheck="false"
            placeholder="// Reiスクリプトを入力してください&#10;// 例:&#10;// param target = &quot;Notepad&quot;  // 対象ウィンドウ名&#10;// set count = 3&#10;// loop $count:&#10;//   click(100, 200)&#10;//   wait(1s)"></textarea>

          <!-- 日本語入力エリア -->
          <div id="nlp-area" class="nlp-area" hidden>
            <input id="nlp-input" type="text" placeholder="例: Chromeを開いてGoogleで検索する" />
            <button id="btn-nlp-convert" class="nlp-btn">変換 →</button>
          </div>
        </section>

        <!-- ===== 実行コントロール ===== -->
        <div id="control-bar">
          <div class="control-left">
            <!-- B: エラーポリシー選択 -->
            <label class="control-label">エラー時:</label>
            <select id="error-policy" class="control-select">
              <option value="stop">停止</option>
              <option value="skip">スキップ</option>
              <option value="retry:2">2回リトライ</option>
              <option value="retry:3">3回リトライ</option>
              <option value="retry:5">5回リトライ</option>
            </select>
          </div>
          <div class="control-center">
            <button id="btn-run" class="run-btn large">▶ 実行</button>
            <button id="btn-stop" class="stop-btn large" disabled>■ 停止</button>
          </div>
          <div class="control-right">
            <!-- C: ステップ実行 -->
            <label class="toggle-label">
              <input id="step-mode-toggle" type="checkbox" />
              <span>ステップ実行</span>
            </label>
            <button id="btn-step-next" class="step-btn" disabled title="次のステップへ">⏭ 次へ</button>
            <button id="btn-step-continue" class="step-btn" disabled title="ステップモード解除して継続">▶▶ 継続</button>
          </div>
        </div>

        <!-- ===== 下部パネル（ログ・変数） ===== -->
        <div id="bottom-panels">
          <!-- タブ -->
          <div class="panel-tabs">
            <button class="panel-tab active" data-panel="log">📋 実行ログ</button>
            <button class="panel-tab" data-panel="vars">🔤 変数一覧</button>
            <button class="panel-tab" data-panel="errors">❌ エラー一覧</button>
            <button class="panel-tab" data-panel="history">📅 実行履歴</button>
            <div class="tab-actions">
              <button id="btn-log-clear" class="tab-action-btn" title="ログをクリア">🗑</button>
              <button id="btn-log-export" class="tab-action-btn" title="ログをエクスポート">💾</button>
            </div>
          </div>

          <!-- C: ログパネル -->
          <div id="panel-log" class="panel-content active">
            <div id="log-container" class="log-container">
              <div class="log-empty">実行するとログが表示されます</div>
            </div>
          </div>

          <!-- D: 変数一覧パネル -->
          <div id="panel-vars" class="panel-content">
            <div class="vars-toolbar">
              <button id="btn-var-add" class="small-btn">+ 変数を追加</button>
            </div>
            <table id="vars-table" class="vars-table">
              <thead>
                <tr>
                  <th>変数名</th>
                  <th>値</th>
                  <th>型</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody id="vars-body">
                <tr class="empty-row">
                  <td colspan="4">変数はありません</td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- B: エラー一覧パネル -->
          <div id="panel-errors" class="panel-content">
            <div id="errors-container" class="errors-container">
              <div class="log-empty">エラーはありません</div>
            </div>
          </div>

          <!-- A: 実行履歴パネル -->
          <div id="panel-history" class="panel-content">
            <div id="history-container" class="history-container">
              <div class="log-empty">履歴はありません</div>
            </div>
          </div>
        </div>

      </main>
    </div><!-- /main-layout -->

  </div><!-- /app -->

  <!-- ========== モーダル: 名前付き保存 ========== -->
  <div id="modal-save" class="modal" hidden>
    <div class="modal-content">
      <div class="modal-header">
        <span>💾 スクリプトを保存</span>
        <button class="modal-close icon-btn">✕</button>
      </div>
      <div class="modal-body">
        <label>スクリプト名</label>
        <input id="save-name-input" type="text" placeholder="スクリプト名を入力..." />
        <label>タグ（カンマ区切り）</label>
        <input id="save-tags-input" type="text" placeholder="例: 自動化, ブラウザ, 定期実行" />
      </div>
      <div class="modal-footer">
        <button id="btn-modal-save-confirm" class="run-btn">保存</button>
        <button class="modal-close cancel-btn">キャンセル</button>
      </div>
    </div>
  </div>

  <!-- ========== ステップ実行インジケーター ========== -->
  <div id="step-indicator" class="step-indicator" hidden>
    <div class="step-indicator-inner">
      <span class="step-icon">⏸</span>
      <div class="step-info">
        <span id="step-line-info" class="step-line-info">Line 1</span>
        <code id="step-command-info" class="step-command-info"></code>
      </div>
      <div class="step-btns">
        <button id="btn-step-next-float" class="run-btn">⏭ 次へ</button>
        <button id="btn-step-continue-float" class="step-btn">▶▶ 継続</button>
      </div>
    </div>
  </div>

  <!-- ========== トースト通知 ========== -->
  <div id="toast-container" class="toast-container"></div>

  <script src="renderer.js"></script>
</body>
</html>
